<!DOCTYPE html>
<html>
<head></head>
<body>

<h1>OpenAI Generate Image</h1>

<!-- View two split window -->
<div align="left">
<table style='text-align: left; width: 300px; display:block'>
<tr>
        
<td>
<h3>[Step 0] Enter Key</h3>
<input id="OPENAI_API_KEY" type="text" value="" placeholder="OPENAI_API_KEY" rows="10" cols="100" style="display:block; text-align: left; width: 150px;">
<br>
<h3>[Step 1] Enter a text description to create an image</h3>
<input id="prompt" type="text" value="" placeholder="prompt" rows="10" cols="100" style="display:block; text-align: left; width: 600px;">
<br>
<h3>[Step 2] Select a model and image size</h3>
<fieldset>
<input type="radio" id="dalle2" name="radio_name" value="dalle2" />
<label for="dalle2">dall-e-2</label>
<br>
<input type="radio" id="dalle3" name="radio_name" value="dalle3" />
<label for="dalle3">dall-e-3</label>
</fieldset>
<br>
<!-- Drop down menu -->
<!-- 256x256, 512x512, or 1024x1024 for dall-e-2 -->
<!-- 1024x1024, 1792x1024, or 1024x1792 for dall-e-3 -->
<label for="image_size">Select a desired image size:</label>
<select name="image_size_list_dalle2" id="image_size_list_dalle2" style="display:none">
  <option value="256x256">256x256</option>
  <option value="512x512">512x512</option>
  <option value="1024x1024">1024x1024</option>
</select>
<select name="image_size_list_dalle3" id="image_size_list_dalle3" style="display:none">
  <option value="1024x1024">1024x1024</option>
  <option value="1792x1024">1792x1024</option>
  <option value="1024x1792">1024x1792</option>
</select> 
<br>
<button id="display_image" onclick="display_image()">display_image</button>
<button id="display_image0" onclick="display_image0()">display_image0</button>
</td>

<!-- View results -->
<td id="display_area">
<div style="width:100%;height:100%;position:absolute;vertical-align:middle;text-align:left;"><canvas id="canvas_img" width="224" height="224" style="display:none"></canvas><div>
<div id="notifications" style="font-family:courier;font-size:15px;"></div>
<div id="errors" style="font-family:courier;font-size:15px;"></div>

</td>

</tr>
</table>
</div>  
	
<!-- --------------------------------------------------- -->

<style>
canvas {border: 1px solid black; position: absolute; display: inline-block; z-index: 1; top: 150px;}

div {position: relative; z-index: 2;}
div#notifications {color: #3236a8; position: relative; z-index: 0;}
div#errors {color: #bd1f17; position: relative; z-index: 0;}

table {border-collapse: collapse;}
td,
th {border: 1px solid black; padding: 10px 20px;}
</style>



<!-- --------------------------------------------------- -->
	
<script>

var model_name = "";
var image_size = "";
var bloburl = "";
	
// ------------------------------------------

async function processEvent_dalle2(event) {
    if (this.getAttribute("checked") == false) {
	document.getElementById("image_size_list_dalle2").style.display = "none";
      document.getElementById("image_size_list_dalle3").style.display = "none";
    } else  {
	document.getElementById("image_size_list_dalle2").style.display = "block";
  document.getElementById("image_size_list_dalle3").style.display = "none";
    }    
}

async function processEvent_dalle3(event) {
    if (this.getAttribute("checked") == false) {
      document.getElementById("image_size_list_dalle2").style.display = "none";
	document.getElementById("image_size_list_dalle3").style.display = "none";
    } else  {
	document.getElementById("image_size_list_dalle2").style.display = "none";
  document.getElementById("image_size_list_dalle3").style.display = "block";
    }    
}

document.getElementById("dalle2").addEventListener("click", processEvent_dalle2, false);
document.getElementById("dalle3").addEventListener("click", processEvent_dalle3, false);

// ------------------------------------------
	

const ctx = document.getElementById("canvas_img").getContext("2d");


async function call_API() {
	var url = 'https://api.openai.com/v1/images/generations';
	
	var headers = {"Content-Type": "application/json", 
		       "Authorization": 'Bearer ' + document.getElementById("OPENAI_API_KEY").value}
		
	const dalle2 = document.getElementById("dalle2").checked;
	const dalle3 = document.getElementById("dalle3").checked;
	
	if (dalle2 == true && dalle3 == false) {
		model_name = 'dall-e-2';
		image_size = document.getElementById("image_size_list_dalle2").value;
	}
	
	if (dalle2 == false && dalle3 == true) {
		model_name = 'dall-e-3';
		image_size = document.getElementById("image_size_list_dalle3").value;
	}
	
	if (dalle2 == false && dalle3 == false) {
		document.getElementById('error').innerHTML = "Select a model name and image size.";
	}
	
	console.log("model_name: ", model_name);
	console.log("image_size: ", image_size);

	var out = "";
	
	if (model_name.length > 0) {
		
		var data = {"model": model_name,
  		    "prompt": document.getElementById("prompt").value, 
  		    "n": 1, 
  		    "size": image_size};
		
		var options = {method : 'POST', headers: headers, body : JSON.stringify(data)};
		
		out = await fetch(url, options)
			.then(res => res.json())
			.then(res => { 
				let output = JSON.parse(JSON.stringify(res)); 
				bloburl = output["data"][0]["url"];
				console.log('bloburl: ', bloburl); 
				return bloburl;
			})
			.catch(error => { document.getElementById('error').innerHTML = error; });
	}

	return out;
}

	
// ------------------------------------------

async function display_image0(){
	
	try {
		const image = new Image();
		
		// image.src = await call_API();
		// OR
		image.src = "https://oaidalleapiprodscus.blob.core.windows.net/private/org-MpmW6OOcWlWnXvFQGjkMPQYq/user-TSIRyCpsFyLvLIf4BlwNRZmW/img-RSA8WEPY0xqX0OrisAF0FBqV.png?st=2024-05-14T11%3A08%3A38Z&se=2024-05-14T13%3A08%3A38Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2024-05-13T23%3A24%3A21Z&ske=2024-05-14T23%3A24%3A21Z&sks=b&skv=2021-08-06&sig=2uPTLG7rIjoxZgXisc1tvzspFG/MmbYz6HiyE9pwTIo%3D";
		bloburl = "https://oaidalleapiprodscus.blob.core.windows.net/private/org-MpmW6OOcWlWnXvFQGjkMPQYq/user-TSIRyCpsFyLvLIf4BlwNRZmW/img-RSA8WEPY0xqX0OrisAF0FBqV.png?st=2024-05-14T11%3A08%3A38Z&se=2024-05-14T13%3A08%3A38Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2024-05-13T23%3A24%3A21Z&ske=2024-05-14T23%3A24%3A21Z&sks=b&skv=2021-08-06&sig=2uPTLG7rIjoxZgXisc1tvzspFG/MmbYz6HiyE9pwTIo%3D";
		
		image.onload = function () { 
			// Draw image on canvas
			document.getElementById("canvas_img").style.display = "block";
			document.getElementById("canvas_img").width = Number(image_size.split('x').pop());
			document.getElementById("canvas_img").height = Number(image_size.split('x').shift());
			ctx.drawImage(image, 0,0);
		};
		
		
		await download_data();
		
	
	} catch (error) {
		document.getElementById("error").innerHTML = error;
	}

}
	
	
async function display_image(){
	
	await new Promise(r => setTimeout(r, 10))
		.then(async function() {
			
			const image = new Image();
			
			// image.src = await call_API();
			// OR
			image.src = "https://oaidalleapiprodscus.blob.core.windows.net/private/org-MpmW6OOcWlWnXvFQGjkMPQYq/user-TSIRyCpsFyLvLIf4BlwNRZmW/img-RSA8WEPY0xqX0OrisAF0FBqV.png?st=2024-05-14T11%3A08%3A38Z&se=2024-05-14T13%3A08%3A38Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2024-05-13T23%3A24%3A21Z&ske=2024-05-14T23%3A24%3A21Z&sks=b&skv=2021-08-06&sig=2uPTLG7rIjoxZgXisc1tvzspFG/MmbYz6HiyE9pwTIo%3D";
			bloburl = "https://oaidalleapiprodscus.blob.core.windows.net/private/org-MpmW6OOcWlWnXvFQGjkMPQYq/user-TSIRyCpsFyLvLIf4BlwNRZmW/img-RSA8WEPY0xqX0OrisAF0FBqV.png?st=2024-05-14T11%3A08%3A38Z&se=2024-05-14T13%3A08%3A38Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2024-05-13T23%3A24%3A21Z&ske=2024-05-14T23%3A24%3A21Z&sks=b&skv=2021-08-06&sig=2uPTLG7rIjoxZgXisc1tvzspFG/MmbYz6HiyE9pwTIo%3D";
			image.onload = await function () { 
				// Draw image on canvas
				document.getElementById("canvas_img").style.display = "block";
				document.getElementById("canvas_img").width = Number(image_size.split('x').pop());
				document.getElementById("canvas_img").height = Number(image_size.split('x').shift());
				ctx.drawImage(image, 0,0);
			};
		})
		.then(async function() { await download_data(); })
		.catch(error => { document.getElementById('error').innerHTML = error; });


}

// -------------------------------------------------

	
async function download_data() {
    
    // ---------------------
    // Puts array into csv format
    // const blob = new Blob([data], { type: 'text/csv;charset=utf-8;' });

    // Create a url for the data object
    // const bloburl = URL.createObjectURL(blob);
    // ---------------------

    const link = document.createElement("a");
    link.setAttribute("href", bloburl);

    const filename = 'img.png';
    link.setAttribute("download", filename);


    let button = document.createElement("button");
	
	let svg = document.createElement("svg");
	svg.setAttribute("aria-hidden", true);
	svg.setAttribute("viewBox", "0 0 10 10");

	let path = document.createElement("path");
	path.setAttribute("d", "M7 9L5 8 3 9V6L1 4h3l1-3 1 3h3L7 6z");
	svg.append(path);
	button.append(svg);
	
	button.onclick = link.click();
	
    // link.style.display = 'block';
	button.style.display = 'block';


    // Download CSV here: blob:https://codesolutions2.github.io/2e7701d0-559c-4be8-87de-61c72fce9a96
    // outp.innerHTML += 'Download CSV here: ' + bloburl + "<br/>";
	
    document.getElementById("display_area").appendChild(button);

    // Automatic download of csv
    // link.click();  // to have the PC prompt where to save the file
    // document.body.removeChild(link);
}

	
// ------------------------------------------


</script>

</body>
</html>
